<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Game Analysis Dashboard – Minigames</title>

    <!-- your global stylesheet -->
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />

    <!-- Chart.js is still available if you need it later -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
        crossorigin="anonymous"></script>

    <!-- --- Tiny page-specific styles --- -->
    <style>
        /* simple responsive grid */
        #gamesGrid {
            --gap: 1rem;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: var(--gap);
            margin: 1.5rem auto;
            max-width: 1200px;
            padding: 0 var(--gap);
        }

        .game-card {
            background: #fff;
            border-radius: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, .08);
            padding: 1rem 1.25rem;
            transition: transform .15s ease, box-shadow .15s ease;
            cursor: pointer;
            text-decoration: none;
            color: inherit;
        }

        .game-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, .12);
        }

        .game-card h2 {
            font-size: 1.05rem;
            margin: 0 0 .25rem;
            font-weight: 600
        }

        .game-card p {
            font-size: .9rem;
            margin: 0;
            color: #555
        }

        body {
            background-color: #ffffff !important;
        }
    </style>
</head>

<body>
    <header>
        <div class="header-content">
            <button id="back-button" onclick="window.location.href='/'">
                <!-- (same SVG arrow as before) -->
                <svg height="16" width="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024">
                    <path
                        d="M874.69 495.52c0 11.3-9.17 20.47-20.47 20.47H249.44l188.08 188.08c7.99 7.99 7.99 20.95 0 28.94-4 3.99-9.24 5.99-14.47 5.99-5.24 0-10.48-2-14.48-5.99L185.51 509.97c-3.84-3.84-5.99-9.05-5.99-14.47 0-5.43 2.16-10.63 5.99-14.47l223.02-223.03c7.99-7.99 20.96-7.99 28.95 0 7.99 8 7.99 20.96 0 28.95L249.43 475.06h604.79c11.3 0 20.47 9.16 20.47 20.46z" />
                </svg>
                <span>Back</span>
            </button>
            <div class="header-title">Game Analysis Dashboard – Minigames</div>
        </div>
    </header>

    <!-- grid is filled by JS -->
    <section id="gamesGrid" class="grid gap-4   /* space between cards           */
                sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4  /* 2-4 cols */
                auto-rows-auto"></section>

    <!-- Modal for Game Stats -->
    <div class="modal fade" id="statsModal" tabindex="-1" aria-labelledby="statsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="statsModalLabel">Game Stats</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="statsModalBody">
                    <p>Loading game statistics...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- AI Summary Modal -->
    <div class="modal fade" id="aiModal" tabindex="-1" aria-labelledby="aiModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="aiModalLabel">AI-Generated Summary</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="aiModalBody">
                    <p>Loading...</p>
                </div>
                <div class="modal-footer">
                    <button class="button d-none" type="button" id="btn-download-analysis">
                        <span class="button__text">Download</span>
                        <span class="button__icon"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 35"
                                id="bdd05811-e15d-428c-bb53-8661459f9307" data-name="Layer 2" class="svg">
                                <path
                                    d="M17.5,22.131a1.249,1.249,0,0,1-1.25-1.25V2.187a1.25,1.25,0,0,1,2.5,0V20.881A1.25,1.25,0,0,1,17.5,22.131Z">
                                </path>
                                <path
                                    d="M17.5,22.693a3.189,3.189,0,0,1-2.262-.936L8.487,15.006a1.249,1.249,0,0,1,1.767-1.767l6.751,6.751a.7.7,0,0,0,.99,0l6.751-6.751a1.25,1.25,0,0,1,1.768,1.767l-6.752,6.751A3.191,3.191,0,0,1,17.5,22.693Z">
                                </path>
                                <path
                                    d="M31.436,34.063H3.564A3.318,3.318,0,0,1,.25,30.749V22.011a1.25,1.25,0,0,1,2.5,0v8.738a.815.815,0,0,0,.814.814H31.436a.815.815,0,0,0,.814-.814V22.011a1.25,1.25,0,1,1,2.5,0v8.738A3.318,3.318,0,0,1,31.436,34.063Z">
                                </path>
                            </svg></span>
                    </button>
                    <button class="button d-none" type="button" id="btn-cancel-analysis" data-bs-dismiss="modal">
                        <span class="button__text">Cancel</span>
                        <span class="button__icon"><svg class="svg" height="512" viewBox="0 0 512 512" width="512"
                                xmlns="http://www.w3.org/2000/svg">
                                <line x1="112" y1="112" x2="400" y2="400"
                                    style="stroke:#fff;stroke-linecap:round;stroke-width:32px" />
                                <line x1="400" y1="112" x2="112" y2="400"
                                    style="stroke:#fff;stroke-linecap:round;stroke-width:32px" />
                            </svg></span>
                    </button>
                    <!-- Regenerate analysis button -->
                    <button class="button d-none" type="button" id="btn-regenerate-analysis">
                        <span class="button__text">Regenerate</span>
                        <span class="button__icon"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20"
                                viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <path d="M21.5 2v6h-6M21.34 15.57a10 10 0 1 1-.57-8.38" />
                            </svg></span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ENjdO4Dr2bkBIFxQpeoK3zY9X9+OrQ6O6rj3Gd+5L3kzW2TrKcHzKHduvU+mjJ8s"
        crossorigin="anonymous"></script>

    <!-- Helper function to show stats modal -->
    <script>
        let statsModalInstance = null;

        function showStatsModal(htmlContent) {
            const modalBody = document.getElementById('statsModalBody');
            modalBody.innerHTML = htmlContent;

            if (!statsModalInstance) {
                statsModalInstance = new bootstrap.Modal(document.getElementById('statsModal'), {
                    backdrop: true
                });
            }

            statsModalInstance.show();
        }

        let aiModalInstance = null;

        function showAiModal(htmlContent) {
            const body = document.getElementById('aiModalBody');
            body.innerHTML = htmlContent;

            if (!aiModalInstance) {
                aiModalInstance = new bootstrap.Modal(document.getElementById('aiModal'), {
                    backdrop: true
                });
            }

            aiModalInstance.show();
        }

        document.getElementById('statsModal').addEventListener('hidden.bs.modal', () => {
            statsModalInstance = null;

            // Force-remove any remaining modal backdrop and cleanup
            document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
            document.body.classList.remove('modal-open');
            document.body.style.paddingRight = '';
        });

        document.getElementById('aiModal').addEventListener('hidden.bs.modal', () => {
            aiModalInstance = null;

            // Force-remove any remaining modal backdrop and cleanup
            document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
            document.body.classList.remove('modal-open');
            document.body.style.paddingRight = '';
        });


    </script>

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="{{ url_for('static', filename='js/minigames_analysis.js') }}"></script>
</body>

</html>